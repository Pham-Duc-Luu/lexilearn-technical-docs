Ph·∫ßn n√†y s·∫Ω gi·ªõi thi·ªÉu v√† m√¥ t·∫£ c√°c Config trong d·ª± √°n m√† s·∫Ω ·∫£nh h∆∞·ªüng ƒë·∫øn to√†n b·ªô c√°ch m√† spring boot ho·∫°t ƒë·ªông, nh·ªØng config n√†y s·∫Ω n·∫±m trong [folder config](https://github.com/Pham-Duc-Luu/Lexilearn-backend-service-spring-boot/tree/main/src/main/java/MainBackendService/config)

---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## C·∫•u h√¨nh CORS trong Spring Boot

ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y c·∫•u h√¨nh **CORS (Cross-Origin Resource Sharing)** trong m·ªôt ·ª©ng d·ª•ng Spring Boot. M·ª•c ti√™u l√† cho ph√©p frontend ho·∫∑c API Gateway truy c·∫≠p v√†o backend th√¥ng qua c√°c HTTP request cross-origin m·ªôt c√°ch an to√†n.

### M·ª•c ƒë√≠ch

Khi frontend v√† backend kh√¥ng c√πng origin (t·ª©c l√† kh√°c domain, port ho·∫∑c giao th·ª©c), tr√¨nh duy·ªát s·∫Ω ch·∫∑n c√°c y√™u c·∫ßu HTTP do ch√≠nh s√°ch b·∫£o m·∫≠t CORS. ƒê·ªÉ cho ph√©p giao ti·∫øp gi·ªØa frontend v√† backend, ta c·∫ßn c·∫•u h√¨nh CORS ƒë·ªÉ:

- Cho ph√©p c√°c HTTP method c·ª• th·ªÉ (GET, POST, PUT, DELETE, OPTIONS)
- Ch·ªâ cho ph√©p request t·ª´ `apiGatewayUrl`
- H·ªó tr·ª£ g·ª≠i cookie (v·ªõi `allowCredentials = true`)

### M√£ ngu·ªìn

```java title="CORS.java"
@Configuration
public class CORS {

    @Value("${apiGatewayUrl}")
    private String apiGatewayUrl;

    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration corsConfig = new CorsConfiguration();
        corsConfig.setAllowedOrigins(List.of(apiGatewayUrl)); // Ch·ªâ cho ph√©p t·ª´ API Gateway
        corsConfig.setAllowedMethods(List.of("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        corsConfig.setAllowedHeaders(List.of("*"));
        corsConfig.setAllowCredentials(true);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", corsConfig);
        return new CorsFilter(source);
    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                       | √ù nghƒ©a                                                                                                                |
| ---------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `@Value("${apiGatewayUrl}")`                   | Inject gi√° tr·ªã c·ªßa URL API Gateway t·ª´ file `application.properties` ho·∫∑c bi·∫øn m√¥i tr∆∞·ªùng.                              |
| `setAllowedOrigins(List.of(apiGatewayUrl))`    | Ch·ªâ cho ph√©p c√°c request ƒë·∫øn t·ª´ domain c·ª• th·ªÉ n√†y. ƒê√¢y l√† c√°ch b·∫£o v·ªá backend kh·ªèi c√°c request tr√°i ph√©p t·ª´ domain l·∫°. |
| `setAllowedMethods(...)`                       | Ch·ªâ ƒë·ªãnh c√°c HTTP method ƒë∆∞·ª£c ph√©p. B·∫°n c√≥ th·ªÉ m·ªü r·ªông ho·∫∑c thu h·∫πp danh s√°ch n√†y t√πy theo nhu c·∫ßu.                    |
| `setAllowedHeaders(List.of("*"))`              | Cho ph√©p t·∫•t c·∫£ c√°c header ƒë∆∞·ª£c g·ª≠i ƒë·∫øn. B·∫°n c√≥ th·ªÉ gi·ªõi h·∫°n header n·∫øu c·∫ßn tƒÉng b·∫£o m·∫≠t.                              |
| `setAllowCredentials(true)`                    | Cho ph√©p g·ª≠i cookies v√† th√¥ng tin x√°c th·ª±c qua c√°c request. B·∫Øt bu·ªôc n·∫øu frontend c·∫ßn x√°c th·ª±c ng∆∞·ªùi d√πng.             |
| `registerCorsConfiguration("/**", corsConfig)` | C·∫•u h√¨nh CORS √°p d·ª•ng cho t·∫•t c·∫£ c√°c endpoint c·ªßa ·ª©ng d·ª•ng.                                                            |

### C·∫•u h√¨nh ·ª©ng v·ªõi `application.properties`

```properties
### ƒê·ªãa ch·ªâ API Gateway ƒë∆∞·ª£c ph√©p g·ªçi ƒë·∫øn backend
apiGatewayUrl=https://api.example.com
```

> ‚ö†Ô∏è **L∆∞u √Ω b·∫£o m·∫≠t**: Kh√¥ng n√™n ƒë·ªÉ `allowedOrigins` l√† `*` n·∫øu `allowCredentials` ƒë∆∞·ª£c b·∫≠t (`true`). Spring s·∫Ω c·∫£nh b√°o ho·∫∑c t·ª´ ch·ªëi request v√¨ ƒëi·ªÅu n√†y vi ph·∫°m chu·∫©n CORS.

---

## C·∫•u h√¨nh Elasticsearch Client trong Spring Boot

C·∫•u h√¨nh n√†y gi√∫p ·ª©ng d·ª•ng Spring Boot c√≥ th·ªÉ k·∫øt n·ªëi t·ªõi c·ª•m **Elasticsearch** th√¥ng qua Elasticsearch Java API Client (`co.elastic.clients.elasticsearch.ElasticsearchClient`), thay v√¨ d√πng c√°c REST call th·ªß c√¥ng.

### M·ª•c ƒë√≠ch

- T·∫°o k·∫øt n·ªëi ƒë·∫øn Elasticsearch th√¥ng qua `RestClient` v√† `ElasticsearchTransport`.
- Thi·∫øt l·∫≠p c√°c header c·∫ßn thi·∫øt cho vi·ªác giao ti·∫øp ƒë√∫ng v·ªõi Elasticsearch.
- T·∫°o m·ªôt `ElasticsearchClient` s·∫µn s√†ng s·ª≠ d·ª•ng trong c√°c service ho·∫∑c repository.

### M√£ ngu·ªìn

```java title="ElasticsearchConfig.java"
@Configuration
public class ElasticsearchConfig {

    @Value("${elasticsearch.host}")
    private String elasticsearchHost;

    @Value("${elasticsearch.port}")
    private String elasticsearchPort;

    @Bean
    public RestClient getRestClient() {
        final CredentialsProvider credentialsProvider = new BasicCredentialsProvider();
        credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials("", ""));
        return RestClient.builder(new HttpHost(elasticsearchHost, Integer.parseInt(elasticsearchPort)))
                .setHttpClientConfigCallback(httpClientBuilder -> {
                    httpClientBuilder.disableAuthCaching();
                    httpClientBuilder.setDefaultHeaders(List.of(
                            new BasicHeader(HttpHeaders.CONTENT_TYPE, ContentType.APPLICATION_JSON)));
                    httpClientBuilder.addInterceptorLast((HttpResponseInterceptor) (response, context) ->
                        response.addHeader("X-Elastic-Product", "Elasticsearch"));
                    return httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider);
                }).build();
    }

    @Bean
    public ElasticsearchTransport getElasticsearchTransport() {
        return new RestClientTransport(getRestClient(), new JacksonJsonpMapper());
    }

    @Bean
    public ElasticsearchClient getElasticsearchClient() {
        return new ElasticsearchClient(getElasticsearchTransport());
    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                                              | √ù nghƒ©a                                                                                                                       |
| --------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| `@Value("${elasticsearch.host}")` & `@Value("${elasticsearch.port}")` | Inject ƒë·ªãa ch·ªâ v√† port c·ªßa Elasticsearch t·ª´ file c·∫•u h√¨nh.                                                                    |
| `RestClient.builder(...)`                                             | Kh·ªüi t·∫°o client s·ª≠ d·ª•ng Apache HTTP client.                                                                                   |
| `disableAuthCaching()`                                                | T·∫Øt cache th√¥ng tin x√°c th·ª±c ƒë·ªÉ tr√°nh sai l·ªách khi c√≥ thay ƒë·ªïi quy·ªÅn.                                                         |
| `setDefaultHeaders(...)`                                              | Thi·∫øt l·∫≠p header `Content-Type: application/json`.                                                                            |
| `addInterceptorLast(...)`                                             | Th√™m header `X-Elastic-Product: Elasticsearch` v√†o m·ªçi response ‚Äî y√™u c·∫ßu c·ªßa Elasticsearch t·ª´ v8 tr·ªü l√™n ƒë·ªÉ x√°c th·ª±c client. |
| `CredentialsProvider`                                                 | D√πng ƒë·ªÉ c·∫•u h√¨nh x√°c th·ª±c c∆° b·∫£n (basic auth) n·∫øu Elasticsearch y√™u c·∫ßu. Trong v√≠ d·ª• n√†y, username v√† password ƒëang ƒë·ªÉ r·ªóng.  |
| `RestClientTransport`                                                 | Giao ti·∫øp gi·ªØa Java API Client v√† Elasticsearch th√¥ng qua transport n√†y.                                                      |
| `ElasticsearchClient`                                                 | Client ch√≠nh ƒë·ªÉ thao t√°c v·ªõi Elasticsearch: t√¨m ki·∫øm, index, c·∫≠p nh·∫≠t, x√≥a, v.v.                                              |

### C·∫•u h√¨nh trong `application.properties`

```properties
elasticsearch.host=localhost
elasticsearch.port=9200
```

> üîê **L∆∞u √Ω b·∫£o m·∫≠t**: N·∫øu Elasticsearch y√™u c·∫ßu authentication, h√£y ƒë·∫£m b·∫£o ƒëi·ªÅn ƒë√∫ng username v√† password t·∫°i ph·∫ßn `UsernamePasswordCredentials`.

### T√†i li·ªáu tham kh·∫£o

- [Elasticsearch Java API Client Documentation](https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/index.html)
- [Spring Boot + Elasticsearch Integration](https://www.elastic.co/blog/getting-started-with-elasticsearch-and-spring-boot)

---

## C·∫•u h√¨nh Email trong Spring Boot

C·∫•u h√¨nh n√†y gi√∫p ·ª©ng d·ª•ng Spring Boot c√≥ th·ªÉ g·ª≠i email th√¥ng qua SMTP server, s·ª≠ d·ª•ng **JavaMailSender** ƒë·ªÉ g·ª≠i c√°c email t·ª´ ·ª©ng d·ª•ng c·ªßa b·∫°n.

### M·ª•c ƒë√≠ch

- C·∫•u h√¨nh k·∫øt n·ªëi v·ªõi SMTP server ƒë·ªÉ g·ª≠i email.
- M√£ h√≥a m·∫≠t kh·∫©u email tr∆∞·ªõc khi s·ª≠ d·ª•ng (Base64 decoding).
- Thi·∫øt l·∫≠p c√°c thu·ªôc t√≠nh c·∫ßn thi·∫øt cho vi·ªác g·ª≠i email qua SMTP.

### M√£ ngu·ªìn

```java title="EmailConfig.java"
@Configuration
public class EmailConfig {

    Logger logger = LogManager.getLogger(EmailConfig.class);

    @Value("${mail.host}")
    private String mailServerHost;

    @Value("${mail.port}")
    private String mailServerPort;

    @Value("${mail.username}")
    private String mailServerUsername;

    @Value("${mail.password}")
    private String mailServerPassword;

    @Bean
    public JavaMailSender getJavaMailSender() {
        String password = new String(Base64.getDecoder().decode(mailServerPassword));
        JavaMailSenderImpl mailSender = new JavaMailSenderImpl();

        mailSender.setHost(mailServerHost);
        mailSender.setPort(Integer.parseInt(mailServerPort));
        mailSender.setUsername(mailServerUsername);
        mailSender.setPassword(password);
        Properties props = mailSender.getJavaMailProperties();
        props.put("mail.transport.protocol", "smtp");
        props.put("mail.smtp.auth", "true");
        props.put("mail.smtp.starttls.enable", "true");
        props.put("mail.debug", "true");

        return mailSender;
    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                                                                                       | √ù nghƒ©a                                                                                                                        |
| -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `@Value("${mail.host}")`, `@Value("${mail.port}")`, `@Value("${mail.username}")`, `@Value("${mail.password}")` | Inject c√°c th√¥ng tin c·∫•u h√¨nh v·ªÅ host, port, username v√† password c·ªßa SMTP server t·ª´ file `application.properties`.            |
| `Base64.getDecoder().decode(mailServerPassword)`                                                               | M√£ h√≥a m·∫≠t kh·∫©u email d∆∞·ªõi d·∫°ng Base64 v√† gi·∫£i m√£ l·∫°i ƒë·ªÉ s·ª≠ d·ª•ng trong c·∫•u h√¨nh. ƒêi·ªÅu n√†y b·∫£o v·ªá m·∫≠t kh·∫©u trong file c·∫•u h√¨nh. |
| `JavaMailSenderImpl`                                                                                           | C√†i ƒë·∫∑t `JavaMailSender`, ƒë·ªëi t∆∞·ª£ng ch√≠nh ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ g·ª≠i email trong Spring Boot.                                         |
| `mail.transport.protocol`                                                                                      | X√°c ƒë·ªãnh giao th·ª©c truy·ªÅn t·∫£i, trong tr∆∞·ªùng h·ª£p n√†y l√† `smtp` ƒë·ªÉ g·ª≠i email qua SMTP.                                           |
| `mail.smtp.auth`                                                                                               | B·∫≠t x√°c th·ª±c SMTP (true) ƒë·ªÉ server y√™u c·∫ßu th√¥ng tin ƒëƒÉng nh·∫≠p.                                                                |
| `mail.smtp.starttls.enable`                                                                                    | B·∫≠t giao th·ª©c b·∫£o m·∫≠t TLS cho k·∫øt n·ªëi SMTP.                                                                                    |
| `mail.debug`                                                                                                   | B·∫≠t ch·∫ø ƒë·ªô debug ƒë·ªÉ ghi log chi ti·∫øt qu√° tr√¨nh g·ª≠i email. ƒêi·ªÅu n√†y h·ªØu √≠ch trong vi·ªác debug c·∫•u h√¨nh email.                    |

### C·∫•u h√¨nh trong `application.properties`

```properties
# C·∫•u h√¨nh cho SMTP Server
mail.host=smtp.mailserver.com
mail.port=587
mail.username=your-email@example.com
mail.password=your-base64-encoded-password
```

> üîê **L∆∞u √Ω b·∫£o m·∫≠t**: M·∫≠t kh·∫©u email ƒë∆∞·ª£c l∆∞u tr·ªØ d∆∞·ªõi d·∫°ng m√£ h√≥a Base64 trong file c·∫•u h√¨nh. ƒê·∫£m b·∫£o r·∫±ng m·∫≠t kh·∫©u n√†y ƒë∆∞·ª£c m√£ h√≥a ƒë√∫ng c√°ch ƒë·ªÉ b·∫£o m·∫≠t.

### V√≠ d·ª• s·ª≠ d·ª•ng `JavaMailSender`

Sau khi c·∫•u h√¨nh, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `JavaMailSender` trong service ƒë·ªÉ g·ª≠i email nh∆∞ sau:

```java
@Service
public class EmailService {

    private final JavaMailSender emailSender;

    public EmailService(JavaMailSender emailSender) {
        this.emailSender = emailSender;
    }

    public void sendSimpleMessage(String to, String subject, String text) {
        SimpleMailMessage message = new SimpleMailMessage();
        message.setFrom("your-email@example.com");
        message.setTo(to);
        message.setSubject(subject);
        message.setText(text);
        emailSender.send(message);
    }
}
```

---

## C·∫•u h√¨nh Kafka Consumer trong Spring Boot

C·∫•u h√¨nh n√†y gi√∫p ·ª©ng d·ª•ng Spring Boot c√≥ th·ªÉ ti√™u th·ª• (consume) d·ªØ li·ªáu t·ª´ c√°c topic Kafka. Kafka Consumer s·∫Ω nh·∫≠n c√°c message t·ª´ Kafka topic v√† x·ª≠ l√Ω ch√∫ng trong ·ª©ng d·ª•ng.

### M·ª•c ƒë√≠ch

- C·∫•u h√¨nh Consumer k·∫øt n·ªëi ƒë·∫øn Kafka Cluster.
- Thi·∫øt l·∫≠p c√°c th√¥ng s·ªë c·∫ßn thi·∫øt ƒë·ªÉ Spring Boot c√≥ th·ªÉ ti√™u th·ª• message t·ª´ Kafka.
- C·∫•u h√¨nh `ConcurrentKafkaListenerContainerFactory` ƒë·ªÉ c√≥ th·ªÉ l·∫Øng nghe v√† x·ª≠ l√Ω c√°c message ƒë·ªìng th·ªùi.

### M√£ ngu·ªìn

```java title="KafkaConsumerConfig.java"
@EnableKafka
@Configuration
public class KafkaConsumerConfig {

    @Value(value = "${spring.kafka.bootstrap-servers}")
    private String bootstrapAddress;

    @Value(value = "${kafka.group.id}")
    private String kafkaGroupId;

    @Bean
    public ConsumerFactory<String, String> consumerFactory() {
        Map<String, Object> props = new HashMap<>();
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);
        props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId);
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        return new DefaultKafkaConsumerFactory<>(props);
    }

    @Bean
    public ConcurrentKafkaListenerContainerFactory<String, String> kafkaListenerContainerFactory() {
        ConcurrentKafkaListenerContainerFactory<String, String> factory =
                new ConcurrentKafkaListenerContainerFactory<>();
        factory.setConsumerFactory(consumerFactory());
        return factory;
    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                                                                          | √ù nghƒ©a                                                                                                                                                             |
| ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `@Value("${spring.kafka.bootstrap-servers}")`                                                     | Inject ƒë·ªãa ch·ªâ c·ªßa Kafka Cluster t·ª´ file c·∫•u h√¨nh `application.properties`.                                                                                         |
| `@Value("${kafka.group.id}")`                                                                     | Inject ID c·ªßa Consumer Group t·ª´ file c·∫•u h√¨nh `application.properties`. M·ªói Consumer Group s·∫Ω nh·∫≠n m·ªôt b·∫£n sao c·ªßa message, gi√∫p ph√¢n ph·ªëi c√¥ng vi·ªác.               |
| `ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG`                                                         | ƒê·ªãa ch·ªâ c·ªßa Kafka Cluster. C√°c consumer s·∫Ω k·∫øt n·ªëi t·ªõi cluster th√¥ng qua c√°c bootstrap server n√†y.                                                                  |
| `ConsumerConfig.GROUP_ID_CONFIG`                                                                  | Consumer Group ID gi√∫p ph√¢n nh√≥m c√°c consumer trong m·ªôt nh√≥m.                                                                                                       |
| `ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG` & `ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG` | Ch·ªâ ƒë·ªãnh c√°ch deserializing key v√† value c·ªßa message. Trong v√≠ d·ª• n√†y, ch√∫ng ta s·ª≠ d·ª•ng `StringDeserializer` cho c·∫£ key v√† value.                                   |
| `ConcurrentKafkaListenerContainerFactory`                                                         | C·∫•u h√¨nh factory cho c√°c Kafka listener, gi√∫p x·ª≠ l√Ω c√°c message t·ª´ Kafka. S·ª≠ d·ª•ng `ConcurrentKafkaListenerContainerFactory` cho ph√©p x·ª≠ l√Ω ƒë·ªìng th·ªùi nhi·ªÅu message. |

### C·∫•u h√¨nh trong `application.properties`

```properties
# ƒê·ªãa ch·ªâ Kafka Bootstrap Servers
spring.kafka.bootstrap-servers=localhost:9092

# Kafka Consumer Group ID
kafka.group.id=my-consumer-group
```

### V√≠ d·ª• s·ª≠ d·ª•ng Kafka Listener

Sau khi c·∫•u h√¨nh, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `@KafkaListener` ƒë·ªÉ l·∫Øng nghe c√°c message t·ª´ Kafka topic nh∆∞ sau:

```java
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Service;

@Service
public class KafkaMessageListener {

    @KafkaListener(topics = "my-topic", groupId = "my-consumer-group")
    public void listen(String message) {
        System.out.println("Received message: " + message);
    }
}
```

> üöÄ **L∆∞u √Ω**: B·∫°n c·∫ßn ƒë·∫£m b·∫£o r·∫±ng Kafka Cluster ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t v√† ch·∫°y tr√™n ƒë·ªãa ch·ªâ m√† b·∫°n ƒë√£ c·∫•u h√¨nh trong `application.properties`.

---

## C·∫•u h√¨nh Kafka Topic trong Spring Boot

C·∫•u h√¨nh n√†y gi√∫p ·ª©ng d·ª•ng Spring Boot c√≥ th·ªÉ t·∫°o v√† qu·∫£n l√Ω Kafka Topics th√¥ng qua `KafkaAdmin`. ƒêi·ªÅu n√†y h·ªØu √≠ch khi b·∫°n c·∫ßn t·∫°o c√°c topic ƒë·ªông trong m√¥i tr∆∞·ªùng ·ª©ng d·ª•ng.

### M·ª•c ƒë√≠ch

- C·∫•u h√¨nh k·∫øt n·ªëi v·ªõi Kafka Cluster ƒë·ªÉ qu·∫£n l√Ω c√°c Kafka Topics.
- Kh·ªüi t·∫°o `KafkaAdmin` ƒë·ªÉ t∆∞∆°ng t√°c v·ªõi Kafka Cluster.

### M√£ ngu·ªìn

```java title="KafkaTopicConfig.java"
@Configuration
public class KafkaTopicConfig {

    @Value(value = "${spring.kafka.bootstrap-servers}")
    private String bootstrapAddress;

    @Bean
    public KafkaAdmin kafkaAdmin() {
        Map<String, Object> configs = new HashMap<>();
        configs.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);
        return new KafkaAdmin(configs);
    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                      | √ù nghƒ©a                                                                                                                |
| --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `@Value("${spring.kafka.bootstrap-servers}")` | Inject ƒë·ªãa ch·ªâ c·ªßa Kafka Cluster t·ª´ file c·∫•u h√¨nh `application.properties`. ƒê√¢y l√† n∆°i ·ª©ng d·ª•ng s·∫Ω k·∫øt n·ªëi t·ªõi Kafka.  |
| `AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG`  | ƒê·ªãa ch·ªâ c·ªßa Kafka Cluster. ƒê√¢y l√† c·∫•u h√¨nh b·∫Øt bu·ªôc ƒë·ªÉ Kafka Admin c√≥ th·ªÉ giao ti·∫øp v·ªõi Kafka.                         |
| `KafkaAdmin`                                  | `KafkaAdmin` l√† l·ªõp qu·∫£n l√Ω Kafka Admin Client trong Spring. N√≥ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o, x√≥a, v√† qu·∫£n l√Ω c√°c topic. |

### C·∫•u h√¨nh trong `application.properties`

```properties
# ƒê·ªãa ch·ªâ Kafka Bootstrap Servers
spring.kafka.bootstrap-servers=localhost:9092
```

### V√≠ d·ª• t·∫°o Topic trong Spring Boot

Sau khi c·∫•u h√¨nh Kafka Admin, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `KafkaAdmin` ƒë·ªÉ t·∫°o topic trong ·ª©ng d·ª•ng c·ªßa b·∫°n:

```java
import org.apache.kafka.clients.admin.NewTopic;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.kafka.core.KafkaAdmin;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class KafkaTopicCreator {

    @Autowired
    private KafkaAdmin kafkaAdmin;

    @Bean
    public NewTopic myTopic() {
        return new NewTopic("my-topic", 1, (short) 1); // T·∫°o topic "my-topic" v·ªõi 1 partition v√† replication factor l√† 1
    }
}
```

> üîß **L∆∞u √Ω**: B·∫°n c√≥ th·ªÉ c·∫•u h√¨nh th√™m c√°c tham s·ªë nh∆∞ s·ªë l∆∞·ª£ng partition, replication factor khi t·∫°o topic m·ªõi.

---

## C·∫•u h√¨nh Web trong Spring Boot

C·∫•u h√¨nh n√†y bao g·ªìm c√°c th√†nh ph·∫ßn ƒë·ªÉ ƒëi·ªÅu khi·ªÉn c√°c y√™u c·∫ßu HTTP, nh∆∞ thi·∫øt l·∫≠p CORS, s·ª≠ d·ª•ng Interceptors ƒë·ªÉ ghi log v√† c·∫•u h√¨nh Argument Resolvers ƒë·ªÉ x·ª≠ l√Ω c√°c tham s·ªë trong ph∆∞∆°ng th·ª©c controller.

### M·ª•c ƒë√≠ch

- Thi·∫øt l·∫≠p CORS ƒë·ªÉ ƒëi·ªÅu khi·ªÉn quy·ªÅn truy c·∫≠p t·ª´ c√°c ngu·ªìn kh√°c nhau.
- ƒêƒÉng k√Ω Interceptor ƒë·ªÉ ghi log c√°c y√™u c·∫ßu.
- C·∫•u h√¨nh Argument Resolver ƒë·ªÉ x·ª≠ l√Ω tham s·ªë trong c√°c ph∆∞∆°ng th·ª©c controller.

### M√£ ngu·ªìn

```java title="WebConfig.java"
@Configuration
public class WebConfig implements WebMvcConfigurer {

    private final AccessTokenDetailsArgumentResolver accessTokenDetailsArgumentResolver;

    @Value("${apiPrefix}")
    private String apiPrefix;

    @Value("${spring.front.end.client.url}")
    private String frontendServer;

    public WebConfig(AccessTokenDetailsArgumentResolver accessTokenDetailsArgumentResolver) {
        this.accessTokenDetailsArgumentResolver = accessTokenDetailsArgumentResolver;
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LoggerInterceptor());
    }

    @Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(accessTokenDetailsArgumentResolver);
    }

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/v1/**")  // Cho ph√©p t·∫•t c·∫£ c√°c endpoint c√≥ prefix "/api/v1/"
                .allowedOrigins(frontendServer)  // Ch·ªâ cho ph√©p c√°c y√™u c·∫ßu t·ª´ frontendServer
                .allowedMethods("GET", "POST", "PUT", "DELETE")  // C√°c ph∆∞∆°ng th·ª©c HTTP ƒë∆∞·ª£c ph√©p
                .allowedHeaders("*")  // Cho ph√©p t·∫•t c·∫£ c√°c header
                .allowCredentials(true);  // Cho ph√©p s·ª≠ d·ª•ng c√°c th√¥ng tin x√°c th·ª±c (cookies, HTTP authentication, v.v.)
    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                   | √ù nghƒ©a                                                                                                                                                           |
| ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `@Value("${apiPrefix}")`                   | Inject ti·ªÅn t·ªë API t·ª´ file c·∫•u h√¨nh `application.properties`.                                                                                                     |
| `@Value("${spring.front.end.client.url}")` | Inject URL c·ªßa server frontend, gi√∫p ki·ªÉm so√°t ngu·ªìn g·ªëc cho CORS.                                                                                                |
| `addInterceptors()`                        | ƒêƒÉng k√Ω c√°c Interceptor ƒë·ªÉ x·ª≠ l√Ω y√™u c·∫ßu HTTP. Trong v√≠ d·ª• n√†y, `LoggerInterceptor` ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ghi log c√°c y√™u c·∫ßu HTTP.                                     |
| `addArgumentResolvers()`                   | ƒêƒÉng k√Ω c√°c Argument Resolvers. ·ªû ƒë√¢y, `AccessTokenDetailsArgumentResolver` s·∫Ω gi·∫£i quy·∫øt c√°c tham s·ªë trong controller.                                           |
| `addCorsMappings()`                        | Thi·∫øt l·∫≠p CORS cho c√°c endpoint c√≥ prefix `/api/v1/**`, ch·ªâ cho ph√©p c√°c y√™u c·∫ßu t·ª´ `frontendServer`, v√† cho ph√©p c√°c ph∆∞∆°ng th·ª©c HTTP l√† GET, POST, PUT, DELETE. |

### C·∫•u h√¨nh trong `application.properties`

```properties
# Ti·ªÅn t·ªë API
apiPrefix=/api/v1

# URL c·ªßa frontend server (gi·∫£ s·ª≠ ·ª©ng d·ª•ng frontend ch·∫°y tr√™n localhost:3000)
spring.front.end.client.url=http://localhost:3000
```

### V√≠ d·ª• s·ª≠ d·ª•ng Interceptor

Khi s·ª≠ d·ª•ng Interceptor, b·∫°n c√≥ th·ªÉ t·∫°o m·ªôt Interceptor ƒë·ªÉ th·ª±c hi·ªán c√°c t√°c v·ª• nh∆∞ ghi log. V√≠ d·ª•:

```java
import org.springframework.web.servlet.HandlerInterceptor;

public class LoggerInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("Request received: " + request.getRequestURI());
        return true;
    }
}
```

> üìÑ **L∆∞u √Ω**: Interceptors gi√∫p b·∫°n th·ª±c hi·ªán c√°c t√°c v·ª• tr∆∞·ªõc khi y√™u c·∫ßu ƒë·∫øn controller, ch·∫≥ng h·∫°n nh∆∞ ki·ªÉm tra x√°c th·ª±c, ghi log, ho·∫∑c theo d√µi th·ªùi gian ph·∫£n h·ªìi.

### V√≠ d·ª• s·ª≠ d·ª•ng Argument Resolver

Argument Resolver c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ gi·∫£i quy·∫øt c√°c tham s·ªë t√πy ch·ªânh trong ph∆∞∆°ng th·ª©c controller, v√≠ d·ª•:

```java
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class MyController {

    @GetMapping("/api/v1/test")
    public String testEndpoint(@RequestParam String accessToken) {
        // Ph∆∞∆°ng th·ª©c n√†y s·∫Ω s·ª≠ d·ª•ng AccessTokenDetailsArgumentResolver ƒë·ªÉ gi·∫£i quy·∫øt accessToken
        return "Access token: " + accessToken;
    }
}
```

---

## C·∫•u h√¨nh b·∫£o m·∫≠t Web trong Spring Boot

C·∫•u h√¨nh n√†y gi√∫p ·ª©ng d·ª•ng Spring Boot b·∫£o v·ªá c√°c endpoint, ƒëi·ªÅu khi·ªÉn quy·ªÅn truy c·∫≠p v√† c·∫•u h√¨nh b·∫£o m·∫≠t cho c√°c y√™u c·∫ßu HTTP.

### M·ª•c ƒë√≠ch

- T·∫Øt b·∫£o v·ªá CSRF (Cross-Site Request Forgery) cho c√°c y√™u c·∫ßu HTTP.
- C·∫•u h√¨nh quy·ªÅn truy c·∫≠p cho c√°c endpoint kh√°c nhau:
  - Cho ph√©p t·∫•t c·∫£ c√°c y√™u c·∫ßu t·ªõi c√°c endpoint b·∫Øt ƒë·∫ßu b·∫±ng `/api/`.
  - Ch·ªâ cho ph√©p ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c truy c·∫≠p c√°c endpoint b·∫Øt ƒë·∫ßu b·∫±ng `/private/`.
  - C√°c y√™u c·∫ßu kh√°c s·∫Ω ƒë∆∞·ª£c ph√©p truy c·∫≠p m√† kh√¥ng y√™u c·∫ßu x√°c th·ª±c.

### M√£ ngu·ªìn

```java title="WebSecurityConfig.java"
@Configuration
@EnableWebSecurity
public class WebSecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        return http
                .csrf(csrf -> csrf.disable())  // T·∫Øt b·∫£o v·ªá CSRF
                .authorizeHttpRequests((requests) -> requests
                        .requestMatchers("/api/.*").permitAll()  // Cho ph√©p t·∫•t c·∫£ y√™u c·∫ßu t·ªõi c√°c endpoint /api/
                        .requestMatchers("/private/.*").authenticated()  // Ch·ªâ cho ph√©p ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c truy c·∫≠p c√°c endpoint /private/
                        .anyRequest().permitAll()  // Cho ph√©p t·∫•t c·∫£ y√™u c·∫ßu c√≤n l·∫°i
                ).build();
    }

    // ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y b·ªã comment l·∫°i v√† c√≥ th·ªÉ s·ª≠ d·ª•ng n·∫øu c·∫ßn t·∫°o ng∆∞·ªùi d√πng trong b·ªô nh·ªõ
//    @Bean
//    public UserDetailsService userDetailsService() {
//        UserDetails user =
//                User.withDefaultPasswordEncoder()
//                        .username("user")
//                        .password("password")
//                        .roles("USER")
//                        .build();
//
//        return new InMemoryUserDetailsManager(user);
//    }
}
```

### Nh·ªØng c·∫•u h√¨nh c·∫ßn ch√∫ √Ω

| C·∫•u h√¨nh                                         | √ù nghƒ©a                                                                                                                         |
| ------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| `@EnableWebSecurity`                             | B·∫≠t t√≠nh nƒÉng b·∫£o m·∫≠t web trong ·ª©ng d·ª•ng Spring Boot.                                                                           |
| `csrf().disable()`                               | T·∫Øt b·∫£o v·ªá CSRF cho c√°c y√™u c·∫ßu HTTP. ƒêi·ªÅu n√†y h·ªØu √≠ch cho c√°c API m√† kh√¥ng y√™u c·∫ßu b·∫£o v·ªá CSRF (v√≠ d·ª•: API RESTful).           |
| `requestMatchers("/api/.*").permitAll()`         | Cho ph√©p t·∫•t c·∫£ c√°c y√™u c·∫ßu HTTP ƒë·∫øn c√°c endpoint b·∫Øt ƒë·∫ßu v·ªõi `/api/`. ƒê√¢y l√† nh·ªØng endpoint c√¥ng khai, kh√¥ng y√™u c·∫ßu x√°c th·ª±c. |
| `requestMatchers("/private/.*").authenticated()` | Ch·ªâ cho ph√©p ng∆∞·ªùi d√πng ƒë√£ x√°c th·ª±c truy c·∫≠p c√°c endpoint b·∫Øt ƒë·∫ßu v·ªõi `/private/`. Nh·ªØng endpoint n√†y y√™u c·∫ßu x√°c th·ª±c.         |
| `anyRequest().permitAll()`                       | Cho ph√©p t·∫•t c·∫£ c√°c y√™u c·∫ßu c√≤n l·∫°i (kh√¥ng ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh r√µ trong c√°c `requestMatchers`) m√† kh√¥ng y√™u c·∫ßu x√°c th·ª±c.             |

### C·∫•u h√¨nh trong `application.properties`

```properties
# C√°c c·∫•u h√¨nh b·∫£o m·∫≠t c√≥ th·ªÉ ƒë∆∞·ª£c th√™m v√†o file application.properties, v√≠ d·ª•:
# T·∫Øt b·∫£o v·ªá CSRF cho API
security.csrf.enabled=false
```

### T·∫°o ng∆∞·ªùi d√πng trong b·ªô nh·ªõ (optional)

ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y ƒë√£ b·ªã comment l·∫°i, nh∆∞ng b·∫°n c√≥ th·ªÉ k√≠ch ho·∫°t ƒë·ªÉ t·∫°o ng∆∞·ªùi d√πng trong b·ªô nh·ªõ cho m·ª•c ƒë√≠ch th·ª≠ nghi·ªám:

```java
@Bean
public UserDetailsService userDetailsService() {
    UserDetails user =
            User.withDefaultPasswordEncoder()
                    .username("user")
                    .password("password")
                    .roles("USER")
                    .build();

    return new InMemoryUserDetailsManager(user);
}
```

ƒêo·∫°n m√£ n√†y t·∫°o m·ªôt ng∆∞·ªùi d√πng v·ªõi t√™n `user`, m·∫≠t kh·∫©u `password`, v√† quy·ªÅn `USER`. Ng∆∞·ªùi d√πng n√†y s·∫Ω ƒë∆∞·ª£c l∆∞u tr·ªØ trong b·ªô nh·ªõ v√† c√≥ th·ªÉ s·ª≠ d·ª•ng ƒë·ªÉ th·ª≠ nghi·ªám t√≠nh nƒÉng x√°c th·ª±c.

### V√≠ d·ª• s·ª≠ d·ª•ng x√°c th·ª±c c∆° b·∫£n

N·∫øu b·∫°n mu·ªën th√™m x√°c th·ª±c c∆° b·∫£n (Basic Authentication) cho ·ª©ng d·ª•ng c·ªßa m√¨nh, c√≥ th·ªÉ c·∫•u h√¨nh nh∆∞ sau:

```java
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    return http
            .csrf(csrf -> csrf.disable())  // T·∫Øt b·∫£o v·ªá CSRF
            .authorizeHttpRequests((requests) -> requests
                    .requestMatchers("/api/.*").permitAll()  // Cho ph√©p t·∫•t c·∫£ y√™u c·∫ßu t·ªõi c√°c endpoint /api/
                    .requestMatchers("/private/.*").authenticated()  // Y√™u c·∫ßu x√°c th·ª±c cho c√°c endpoint /private/
                    .anyRequest().permitAll()
            )
            .httpBasic()  // B·∫≠t Basic Authentication
            .and()
            .build();
}
```

---
