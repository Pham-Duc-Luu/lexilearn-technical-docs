Pháº§n nÃ y sáº½ giá»›i thiá»ƒu vÃ  mÃ´ táº£ cÃ¡c Config trong dá»± Ã¡n mÃ  sáº½ áº£nh hÆ°á»Ÿng Ä‘áº¿n toÃ n bá»™ cÃ¡ch mÃ  spring boot hoáº¡t Ä‘á»™ng, nhá»¯ng config nÃ y sáº½ náº±m trong [folder config](https://github.com/Pham-Duc-Luu/Lexilearn-backend-service-spring-boot/tree/main/src/main/java/MainBackendService/config)

---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

## Cáº¥u hÃ¬nh CORS trong Spring Boot

Äoáº¡n mÃ£ dÆ°á»›i Ä‘Ã¢y cáº¥u hÃ¬nh **CORS (Cross-Origin Resource Sharing)** trong má»™t á»©ng dá»¥ng Spring Boot. Má»¥c tiÃªu lÃ  cho phÃ©p frontend hoáº·c API Gateway truy cáº­p vÃ o backend thÃ´ng qua cÃ¡c HTTP request cross-origin má»™t cÃ¡ch an toÃ n.

### Má»¥c Ä‘Ã­ch

Khi frontend vÃ  backend khÃ´ng cÃ¹ng origin (tá»©c lÃ  khÃ¡c domain, port hoáº·c giao thá»©c), trÃ¬nh duyá»‡t sáº½ cháº·n cÃ¡c yÃªu cáº§u HTTP do chÃ­nh sÃ¡ch báº£o máº­t CORS. Äá»ƒ cho phÃ©p giao tiáº¿p giá»¯a frontend vÃ  backend, ta cáº§n cáº¥u hÃ¬nh CORS Ä‘á»ƒ:

- Cho phÃ©p cÃ¡c HTTP method cá»¥ thá»ƒ (GET, POST, PUT, DELETE, OPTIONS)
- Chá»‰ cho phÃ©p request tá»« `apiGatewayUrl`
- Há»— trá»£ gá»­i cookie (vá»›i `allowCredentials = true`)

### MÃ£ nguá»“n

```java title="CORS.java"
@Configuration
public class CORS {

    @Value("${apiGatewayUrl}")
    private String apiGatewayUrl;

    @Bean
    public CorsFilter corsFilter() {
        CorsConfiguration corsConfig = new CorsConfiguration();
        corsConfig.setAllowedOrigins(List.of(apiGatewayUrl)); // Chá»‰ cho phÃ©p tá»« API Gateway
        corsConfig.setAllowedMethods(List.of("GET", "POST", "PUT", "DELETE", "OPTIONS"));
        corsConfig.setAllowedHeaders(List.of("*"));
        corsConfig.setAllowCredentials(true);

        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
        source.registerCorsConfiguration("/**", corsConfig);
        return new CorsFilter(source);
    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                       | Ã nghÄ©a                                                                                                                |
| ---------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `@Value("${apiGatewayUrl}")`                   | Inject giÃ¡ trá»‹ cá»§a URL API Gateway tá»« file `application.properties` hoáº·c biáº¿n mÃ´i trÆ°á»ng.                              |
| `setAllowedOrigins(List.of(apiGatewayUrl))`    | Chá»‰ cho phÃ©p cÃ¡c request Ä‘áº¿n tá»« domain cá»¥ thá»ƒ nÃ y. ÄÃ¢y lÃ  cÃ¡ch báº£o vá»‡ backend khá»i cÃ¡c request trÃ¡i phÃ©p tá»« domain láº¡. |
| `setAllowedMethods(...)`                       | Chá»‰ Ä‘á»‹nh cÃ¡c HTTP method Ä‘Æ°á»£c phÃ©p. Báº¡n cÃ³ thá»ƒ má»Ÿ rá»™ng hoáº·c thu háº¹p danh sÃ¡ch nÃ y tÃ¹y theo nhu cáº§u.                    |
| `setAllowedHeaders(List.of("*"))`              | Cho phÃ©p táº¥t cáº£ cÃ¡c header Ä‘Æ°á»£c gá»­i Ä‘áº¿n. Báº¡n cÃ³ thá»ƒ giá»›i háº¡n header náº¿u cáº§n tÄƒng báº£o máº­t.                              |
| `setAllowCredentials(true)`                    | Cho phÃ©p gá»­i cookies vÃ  thÃ´ng tin xÃ¡c thá»±c qua cÃ¡c request. Báº¯t buá»™c náº¿u frontend cáº§n xÃ¡c thá»±c ngÆ°á»i dÃ¹ng.             |
| `registerCorsConfiguration("/**", corsConfig)` | Cáº¥u hÃ¬nh CORS Ã¡p dá»¥ng cho táº¥t cáº£ cÃ¡c endpoint cá»§a á»©ng dá»¥ng.                                                            |

### Cáº¥u hÃ¬nh á»©ng vá»›i `application.properties`

```properties
### Äá»‹a chá»‰ API Gateway Ä‘Æ°á»£c phÃ©p gá»i Ä‘áº¿n backend
apiGatewayUrl=https://api.example.com
```

> âš ï¸ **LÆ°u Ã½ báº£o máº­t**: KhÃ´ng nÃªn Ä‘á»ƒ `allowedOrigins` lÃ  `*` náº¿u `allowCredentials` Ä‘Æ°á»£c báº­t (`true`). Spring sáº½ cáº£nh bÃ¡o hoáº·c tá»« chá»‘i request vÃ¬ Ä‘iá»u nÃ y vi pháº¡m chuáº©n CORS.

---

## Cáº¥u hÃ¬nh Elasticsearch Client trong Spring Boot

Cáº¥u hÃ¬nh nÃ y giÃºp á»©ng dá»¥ng Spring Boot cÃ³ thá»ƒ káº¿t ná»‘i tá»›i cá»¥m **Elasticsearch** thÃ´ng qua Elasticsearch Java API Client (`co.elastic.clients.elasticsearch.ElasticsearchClient`), thay vÃ¬ dÃ¹ng cÃ¡c REST call thá»§ cÃ´ng.

### Má»¥c Ä‘Ã­ch

- Táº¡o káº¿t ná»‘i Ä‘áº¿n Elasticsearch thÃ´ng qua `RestClient` vÃ  `ElasticsearchTransport`.
- Thiáº¿t láº­p cÃ¡c header cáº§n thiáº¿t cho viá»‡c giao tiáº¿p Ä‘Ãºng vá»›i Elasticsearch.
- Táº¡o má»™t `ElasticsearchClient` sáºµn sÃ ng sá»­ dá»¥ng trong cÃ¡c service hoáº·c repository.

### MÃ£ nguá»“n

```java title="ElasticsearchConfig.java"
@Configuration
public class ElasticsearchConfig {

    @Value("${elasticsearch.host}")
    private String elasticsearchHost;

    @Value("${elasticsearch.port}")
    private String elasticsearchPort;

    @Bean
    public RestClient getRestClient() {
        final CredentialsProvider credentialsProvider = new BasicCredentialsProvider();
        credentialsProvider.setCredentials(AuthScope.ANY, new UsernamePasswordCredentials("", ""));
        return RestClient.builder(new HttpHost(elasticsearchHost, Integer.parseInt(elasticsearchPort)))
                .setHttpClientConfigCallback(httpClientBuilder -> {
                    httpClientBuilder.disableAuthCaching();
                    httpClientBuilder.setDefaultHeaders(List.of(
                            new BasicHeader(HttpHeaders.CONTENT_TYPE, ContentType.APPLICATION_JSON)));
                    httpClientBuilder.addInterceptorLast((HttpResponseInterceptor) (response, context) ->
                        response.addHeader("X-Elastic-Product", "Elasticsearch"));
                    return httpClientBuilder.setDefaultCredentialsProvider(credentialsProvider);
                }).build();
    }

    @Bean
    public ElasticsearchTransport getElasticsearchTransport() {
        return new RestClientTransport(getRestClient(), new JacksonJsonpMapper());
    }

    @Bean
    public ElasticsearchClient getElasticsearchClient() {
        return new ElasticsearchClient(getElasticsearchTransport());
    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                                              | Ã nghÄ©a                                                                                                                       |
| --------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------- |
| `@Value("${elasticsearch.host}")` & `@Value("${elasticsearch.port}")` | Inject Ä‘á»‹a chá»‰ vÃ  port cá»§a Elasticsearch tá»« file cáº¥u hÃ¬nh.                                                                    |
| `RestClient.builder(...)`                                             | Khá»Ÿi táº¡o client sá»­ dá»¥ng Apache HTTP client.                                                                                   |
| `disableAuthCaching()`                                                | Táº¯t cache thÃ´ng tin xÃ¡c thá»±c Ä‘á»ƒ trÃ¡nh sai lá»‡ch khi cÃ³ thay Ä‘á»•i quyá»n.                                                         |
| `setDefaultHeaders(...)`                                              | Thiáº¿t láº­p header `Content-Type: application/json`.                                                                            |
| `addInterceptorLast(...)`                                             | ThÃªm header `X-Elastic-Product: Elasticsearch` vÃ o má»i response â€” yÃªu cáº§u cá»§a Elasticsearch tá»« v8 trá»Ÿ lÃªn Ä‘á»ƒ xÃ¡c thá»±c client. |
| `CredentialsProvider`                                                 | DÃ¹ng Ä‘á»ƒ cáº¥u hÃ¬nh xÃ¡c thá»±c cÆ¡ báº£n (basic auth) náº¿u Elasticsearch yÃªu cáº§u. Trong vÃ­ dá»¥ nÃ y, username vÃ  password Ä‘ang Ä‘á»ƒ rá»—ng.  |
| `RestClientTransport`                                                 | Giao tiáº¿p giá»¯a Java API Client vÃ  Elasticsearch thÃ´ng qua transport nÃ y.                                                      |
| `ElasticsearchClient`                                                 | Client chÃ­nh Ä‘á»ƒ thao tÃ¡c vá»›i Elasticsearch: tÃ¬m kiáº¿m, index, cáº­p nháº­t, xÃ³a, v.v.                                              |

### Cáº¥u hÃ¬nh trong `application.properties`

```properties
elasticsearch.host=localhost
elasticsearch.port=9200
```

> ğŸ” **LÆ°u Ã½ báº£o máº­t**: Náº¿u Elasticsearch yÃªu cáº§u authentication, hÃ£y Ä‘áº£m báº£o Ä‘iá»n Ä‘Ãºng username vÃ  password táº¡i pháº§n `UsernamePasswordCredentials`.

### TÃ i liá»‡u tham kháº£o

- [Elasticsearch Java API Client Documentation](https://www.elastic.co/guide/en/elasticsearch/client/java-api-client/current/index.html)
- [Spring Boot + Elasticsearch Integration](https://www.elastic.co/blog/getting-started-with-elasticsearch-and-spring-boot)

---

## Cáº¥u hÃ¬nh Email trong Spring Boot

Cáº¥u hÃ¬nh nÃ y giÃºp á»©ng dá»¥ng Spring Boot cÃ³ thá»ƒ gá»­i email thÃ´ng qua SMTP server, sá»­ dá»¥ng **JavaMailSender** Ä‘á»ƒ gá»­i cÃ¡c email tá»« á»©ng dá»¥ng cá»§a báº¡n.

### Má»¥c Ä‘Ã­ch

- Cáº¥u hÃ¬nh káº¿t ná»‘i vá»›i SMTP server Ä‘á»ƒ gá»­i email.
- MÃ£ hÃ³a máº­t kháº©u email trÆ°á»›c khi sá»­ dá»¥ng (Base64 decoding).
- Thiáº¿t láº­p cÃ¡c thuá»™c tÃ­nh cáº§n thiáº¿t cho viá»‡c gá»­i email qua SMTP.

### MÃ£ nguá»“n

```java title="EmailConfig.java"
@Configuration
public class EmailConfig {

    Logger logger = LogManager.getLogger(EmailConfig.class);

    @Value("${mail.host}")
    private String mailServerHost;

    @Value("${mail.port}")
    private String mailServerPort;

    @Value("${mail.username}")
    private String mailServerUsername;

    @Value("${mail.password}")
    private String mailServerPassword;

    @Bean
    public JavaMailSender getJavaMailSender() {
        String password = new String(Base64.getDecoder().decode(mailServerPassword));
        JavaMailSenderImpl mailSender = new JavaMailSenderImpl();

        mailSender.setHost(mailServerHost);
        mailSender.setPort(Integer.parseInt(mailServerPort));
        mailSender.setUsername(mailServerUsername);
        mailSender.setPassword(password);
        Properties props = mailSender.getJavaMailProperties();
        props.put("mail.transport.protocol", "smtp");
        props.put("mail.smtp.auth", "true");
        props.put("mail.smtp.starttls.enable", "true");
        props.put("mail.debug", "true");

        return mailSender;
    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                                                                                       | Ã nghÄ©a                                                                                                                        |
| -------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ |
| `@Value("${mail.host}")`, `@Value("${mail.port}")`, `@Value("${mail.username}")`, `@Value("${mail.password}")` | Inject cÃ¡c thÃ´ng tin cáº¥u hÃ¬nh vá» host, port, username vÃ  password cá»§a SMTP server tá»« file `application.properties`.            |
| `Base64.getDecoder().decode(mailServerPassword)`                                                               | MÃ£ hÃ³a máº­t kháº©u email dÆ°á»›i dáº¡ng Base64 vÃ  giáº£i mÃ£ láº¡i Ä‘á»ƒ sá»­ dá»¥ng trong cáº¥u hÃ¬nh. Äiá»u nÃ y báº£o vá»‡ máº­t kháº©u trong file cáº¥u hÃ¬nh. |
| `JavaMailSenderImpl`                                                                                           | CÃ i Ä‘áº·t `JavaMailSender`, Ä‘á»‘i tÆ°á»£ng chÃ­nh Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ gá»­i email trong Spring Boot.                                         |
| `mail.transport.protocol`                                                                                      | XÃ¡c Ä‘á»‹nh giao thá»©c truyá»n táº£i, trong trÆ°á»ng há»£p nÃ y lÃ  `smtp` Ä‘á»ƒ gá»­i email qua SMTP.                                           |
| `mail.smtp.auth`                                                                                               | Báº­t xÃ¡c thá»±c SMTP (true) Ä‘á»ƒ server yÃªu cáº§u thÃ´ng tin Ä‘Äƒng nháº­p.                                                                |
| `mail.smtp.starttls.enable`                                                                                    | Báº­t giao thá»©c báº£o máº­t TLS cho káº¿t ná»‘i SMTP.                                                                                    |
| `mail.debug`                                                                                                   | Báº­t cháº¿ Ä‘á»™ debug Ä‘á»ƒ ghi log chi tiáº¿t quÃ¡ trÃ¬nh gá»­i email. Äiá»u nÃ y há»¯u Ã­ch trong viá»‡c debug cáº¥u hÃ¬nh email.                    |

### Cáº¥u hÃ¬nh trong `application.properties`

```properties
# Cáº¥u hÃ¬nh cho SMTP Server
mail.host=smtp.mailserver.com
mail.port=587
mail.username=your-email@example.com
mail.password=your-base64-encoded-password
```

> ğŸ” **LÆ°u Ã½ báº£o máº­t**: Máº­t kháº©u email Ä‘Æ°á»£c lÆ°u trá»¯ dÆ°á»›i dáº¡ng mÃ£ hÃ³a Base64 trong file cáº¥u hÃ¬nh. Äáº£m báº£o ráº±ng máº­t kháº©u nÃ y Ä‘Æ°á»£c mÃ£ hÃ³a Ä‘Ãºng cÃ¡ch Ä‘á»ƒ báº£o máº­t.

### VÃ­ dá»¥ sá»­ dá»¥ng `JavaMailSender`

Sau khi cáº¥u hÃ¬nh, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `JavaMailSender` trong service Ä‘á»ƒ gá»­i email nhÆ° sau:

```java
@Service
public class EmailService {

    private final JavaMailSender emailSender;

    public EmailService(JavaMailSender emailSender) {
        this.emailSender = emailSender;
    }

    public void sendSimpleMessage(String to, String subject, String text) {
        SimpleMailMessage message = new SimpleMailMessage();
        message.setFrom("your-email@example.com");
        message.setTo(to);
        message.setSubject(subject);
        message.setText(text);
        emailSender.send(message);
    }
}
```

---

## Cáº¥u hÃ¬nh Kafka Consumer trong Spring Boot

Cáº¥u hÃ¬nh nÃ y giÃºp á»©ng dá»¥ng Spring Boot cÃ³ thá»ƒ tiÃªu thá»¥ (consume) dá»¯ liá»‡u tá»« cÃ¡c topic Kafka. Kafka Consumer sáº½ nháº­n cÃ¡c message tá»« Kafka topic vÃ  xá»­ lÃ½ chÃºng trong á»©ng dá»¥ng.

### Má»¥c Ä‘Ã­ch

- Cáº¥u hÃ¬nh Consumer káº¿t ná»‘i Ä‘áº¿n Kafka Cluster.
- Thiáº¿t láº­p cÃ¡c thÃ´ng sá»‘ cáº§n thiáº¿t Ä‘á»ƒ Spring Boot cÃ³ thá»ƒ tiÃªu thá»¥ message tá»« Kafka.
- Cáº¥u hÃ¬nh `ConcurrentKafkaListenerContainerFactory` Ä‘á»ƒ cÃ³ thá»ƒ láº¯ng nghe vÃ  xá»­ lÃ½ cÃ¡c message Ä‘á»“ng thá»i.

### MÃ£ nguá»“n

```java title="KafkaConsumerConfig.java"
@EnableKafka
@Configuration
public class KafkaConsumerConfig {

    @Value(value = "${spring.kafka.bootstrap-servers}")
    private String bootstrapAddress;

    @Value(value = "${kafka.group.id}")
    private String kafkaGroupId;

    @Bean
    public ConsumerFactory<String, String> consumerFactory() {
        Map<String, Object> props = new HashMap<>();
        props.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);
        props.put(ConsumerConfig.GROUP_ID_CONFIG, kafkaGroupId);
        props.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        props.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class);
        return new DefaultKafkaConsumerFactory<>(props);
    }

    @Bean
    public ConcurrentKafkaListenerContainerFactory<String, String> kafkaListenerContainerFactory() {
        ConcurrentKafkaListenerContainerFactory<String, String> factory =
                new ConcurrentKafkaListenerContainerFactory<>();
        factory.setConsumerFactory(consumerFactory());
        return factory;
    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                                                                          | Ã nghÄ©a                                                                                                                                                             |
| ------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `@Value("${spring.kafka.bootstrap-servers}")`                                                     | Inject Ä‘á»‹a chá»‰ cá»§a Kafka Cluster tá»« file cáº¥u hÃ¬nh `application.properties`.                                                                                         |
| `@Value("${kafka.group.id}")`                                                                     | Inject ID cá»§a Consumer Group tá»« file cáº¥u hÃ¬nh `application.properties`. Má»—i Consumer Group sáº½ nháº­n má»™t báº£n sao cá»§a message, giÃºp phÃ¢n phá»‘i cÃ´ng viá»‡c.               |
| `ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG`                                                         | Äá»‹a chá»‰ cá»§a Kafka Cluster. CÃ¡c consumer sáº½ káº¿t ná»‘i tá»›i cluster thÃ´ng qua cÃ¡c bootstrap server nÃ y.                                                                  |
| `ConsumerConfig.GROUP_ID_CONFIG`                                                                  | Consumer Group ID giÃºp phÃ¢n nhÃ³m cÃ¡c consumer trong má»™t nhÃ³m.                                                                                                       |
| `ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG` & `ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG` | Chá»‰ Ä‘á»‹nh cÃ¡ch deserializing key vÃ  value cá»§a message. Trong vÃ­ dá»¥ nÃ y, chÃºng ta sá»­ dá»¥ng `StringDeserializer` cho cáº£ key vÃ  value.                                   |
| `ConcurrentKafkaListenerContainerFactory`                                                         | Cáº¥u hÃ¬nh factory cho cÃ¡c Kafka listener, giÃºp xá»­ lÃ½ cÃ¡c message tá»« Kafka. Sá»­ dá»¥ng `ConcurrentKafkaListenerContainerFactory` cho phÃ©p xá»­ lÃ½ Ä‘á»“ng thá»i nhiá»u message. |

### Cáº¥u hÃ¬nh trong `application.properties`

```properties
# Äá»‹a chá»‰ Kafka Bootstrap Servers
spring.kafka.bootstrap-servers=localhost:9092

# Kafka Consumer Group ID
kafka.group.id=my-consumer-group
```

### VÃ­ dá»¥ sá»­ dá»¥ng Kafka Listener

Sau khi cáº¥u hÃ¬nh, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `@KafkaListener` Ä‘á»ƒ láº¯ng nghe cÃ¡c message tá»« Kafka topic nhÆ° sau:

```java
import org.springframework.kafka.annotation.KafkaListener;
import org.springframework.stereotype.Service;

@Service
public class KafkaMessageListener {

    @KafkaListener(topics = "my-topic", groupId = "my-consumer-group")
    public void listen(String message) {
        System.out.println("Received message: " + message);
    }
}
```

> ğŸš€ **LÆ°u Ã½**: Báº¡n cáº§n Ä‘áº£m báº£o ráº±ng Kafka Cluster Ä‘Ã£ Ä‘Æ°á»£c cÃ i Ä‘áº·t vÃ  cháº¡y trÃªn Ä‘á»‹a chá»‰ mÃ  báº¡n Ä‘Ã£ cáº¥u hÃ¬nh trong `application.properties`.

---

## Cáº¥u hÃ¬nh Kafka Topic trong Spring Boot

Cáº¥u hÃ¬nh nÃ y giÃºp á»©ng dá»¥ng Spring Boot cÃ³ thá»ƒ táº¡o vÃ  quáº£n lÃ½ Kafka Topics thÃ´ng qua `KafkaAdmin`. Äiá»u nÃ y há»¯u Ã­ch khi báº¡n cáº§n táº¡o cÃ¡c topic Ä‘á»™ng trong mÃ´i trÆ°á»ng á»©ng dá»¥ng.

### Má»¥c Ä‘Ã­ch

- Cáº¥u hÃ¬nh káº¿t ná»‘i vá»›i Kafka Cluster Ä‘á»ƒ quáº£n lÃ½ cÃ¡c Kafka Topics.
- Khá»Ÿi táº¡o `KafkaAdmin` Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i Kafka Cluster.

### MÃ£ nguá»“n

```java title="KafkaTopicConfig.java"
@Configuration
public class KafkaTopicConfig {

    @Value(value = "${spring.kafka.bootstrap-servers}")
    private String bootstrapAddress;

    @Bean
    public KafkaAdmin kafkaAdmin() {
        Map<String, Object> configs = new HashMap<>();
        configs.put(AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG, bootstrapAddress);
        return new KafkaAdmin(configs);
    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                      | Ã nghÄ©a                                                                                                                |
| --------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| `@Value("${spring.kafka.bootstrap-servers}")` | Inject Ä‘á»‹a chá»‰ cá»§a Kafka Cluster tá»« file cáº¥u hÃ¬nh `application.properties`. ÄÃ¢y lÃ  nÆ¡i á»©ng dá»¥ng sáº½ káº¿t ná»‘i tá»›i Kafka.  |
| `AdminClientConfig.BOOTSTRAP_SERVERS_CONFIG`  | Äá»‹a chá»‰ cá»§a Kafka Cluster. ÄÃ¢y lÃ  cáº¥u hÃ¬nh báº¯t buá»™c Ä‘á»ƒ Kafka Admin cÃ³ thá»ƒ giao tiáº¿p vá»›i Kafka.                         |
| `KafkaAdmin`                                  | `KafkaAdmin` lÃ  lá»›p quáº£n lÃ½ Kafka Admin Client trong Spring. NÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o, xÃ³a, vÃ  quáº£n lÃ½ cÃ¡c topic. |

### Cáº¥u hÃ¬nh trong `application.properties`

```properties
# Äá»‹a chá»‰ Kafka Bootstrap Servers
spring.kafka.bootstrap-servers=localhost:9092
```

### VÃ­ dá»¥ táº¡o Topic trong Spring Boot

Sau khi cáº¥u hÃ¬nh Kafka Admin, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng `KafkaAdmin` Ä‘á»ƒ táº¡o topic trong á»©ng dá»¥ng cá»§a báº¡n:

```java
import org.apache.kafka.clients.admin.NewTopic;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.kafka.core.KafkaAdmin;
import org.springframework.kafka.core.KafkaTemplate;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class KafkaTopicCreator {

    @Autowired
    private KafkaAdmin kafkaAdmin;

    @Bean
    public NewTopic myTopic() {
        return new NewTopic("my-topic", 1, (short) 1); // Táº¡o topic "my-topic" vá»›i 1 partition vÃ  replication factor lÃ  1
    }
}
```

> ğŸ”§ **LÆ°u Ã½**: Báº¡n cÃ³ thá»ƒ cáº¥u hÃ¬nh thÃªm cÃ¡c tham sá»‘ nhÆ° sá»‘ lÆ°á»£ng partition, replication factor khi táº¡o topic má»›i.

---

## Cáº¥u hÃ¬nh Web trong Spring Boot

Cáº¥u hÃ¬nh nÃ y bao gá»“m cÃ¡c thÃ nh pháº§n Ä‘á»ƒ Ä‘iá»u khiá»ƒn cÃ¡c yÃªu cáº§u HTTP, nhÆ° thiáº¿t láº­p CORS, sá»­ dá»¥ng Interceptors Ä‘á»ƒ ghi log vÃ  cáº¥u hÃ¬nh Argument Resolvers Ä‘á»ƒ xá»­ lÃ½ cÃ¡c tham sá»‘ trong phÆ°Æ¡ng thá»©c controller.

### Má»¥c Ä‘Ã­ch

- Thiáº¿t láº­p CORS Ä‘á»ƒ Ä‘iá»u khiá»ƒn quyá»n truy cáº­p tá»« cÃ¡c nguá»“n khÃ¡c nhau.
- ÄÄƒng kÃ½ Interceptor Ä‘á»ƒ ghi log cÃ¡c yÃªu cáº§u.
- Cáº¥u hÃ¬nh Argument Resolver Ä‘á»ƒ xá»­ lÃ½ tham sá»‘ trong cÃ¡c phÆ°Æ¡ng thá»©c controller.

### MÃ£ nguá»“n

```java title="WebConfig.java"
@Configuration
public class WebConfig implements WebMvcConfigurer {

    private final AccessTokenDetailsArgumentResolver accessTokenDetailsArgumentResolver;

    @Value("${apiPrefix}")
    private String apiPrefix;

    @Value("${spring.front.end.client.url}")
    private String frontendServer;

    public WebConfig(AccessTokenDetailsArgumentResolver accessTokenDetailsArgumentResolver) {
        this.accessTokenDetailsArgumentResolver = accessTokenDetailsArgumentResolver;
    }

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(new LoggerInterceptor());
    }

    @Override
    public void addArgumentResolvers(List<HandlerMethodArgumentResolver> resolvers) {
        resolvers.add(accessTokenDetailsArgumentResolver);
    }

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/api/v1/**")  // Cho phÃ©p táº¥t cáº£ cÃ¡c endpoint cÃ³ prefix "/api/v1/"
                .allowedOrigins(frontendServer)  // Chá»‰ cho phÃ©p cÃ¡c yÃªu cáº§u tá»« frontendServer
                .allowedMethods("GET", "POST", "PUT", "DELETE")  // CÃ¡c phÆ°Æ¡ng thá»©c HTTP Ä‘Æ°á»£c phÃ©p
                .allowedHeaders("*")  // Cho phÃ©p táº¥t cáº£ cÃ¡c header
                .allowCredentials(true);  // Cho phÃ©p sá»­ dá»¥ng cÃ¡c thÃ´ng tin xÃ¡c thá»±c (cookies, HTTP authentication, v.v.)
    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                   | Ã nghÄ©a                                                                                                                                                           |
| ------------------------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `@Value("${apiPrefix}")`                   | Inject tiá»n tá»‘ API tá»« file cáº¥u hÃ¬nh `application.properties`.                                                                                                     |
| `@Value("${spring.front.end.client.url}")` | Inject URL cá»§a server frontend, giÃºp kiá»ƒm soÃ¡t nguá»“n gá»‘c cho CORS.                                                                                                |
| `addInterceptors()`                        | ÄÄƒng kÃ½ cÃ¡c Interceptor Ä‘á»ƒ xá»­ lÃ½ yÃªu cáº§u HTTP. Trong vÃ­ dá»¥ nÃ y, `LoggerInterceptor` Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ ghi log cÃ¡c yÃªu cáº§u HTTP.                                     |
| `addArgumentResolvers()`                   | ÄÄƒng kÃ½ cÃ¡c Argument Resolvers. á» Ä‘Ã¢y, `AccessTokenDetailsArgumentResolver` sáº½ giáº£i quyáº¿t cÃ¡c tham sá»‘ trong controller.                                           |
| `addCorsMappings()`                        | Thiáº¿t láº­p CORS cho cÃ¡c endpoint cÃ³ prefix `/api/v1/**`, chá»‰ cho phÃ©p cÃ¡c yÃªu cáº§u tá»« `frontendServer`, vÃ  cho phÃ©p cÃ¡c phÆ°Æ¡ng thá»©c HTTP lÃ  GET, POST, PUT, DELETE. |

### Cáº¥u hÃ¬nh trong `application.properties`

```properties
# Tiá»n tá»‘ API
apiPrefix=/api/v1

# URL cá»§a frontend server (giáº£ sá»­ á»©ng dá»¥ng frontend cháº¡y trÃªn localhost:3000)
spring.front.end.client.url=http://localhost:3000
```

### VÃ­ dá»¥ sá»­ dá»¥ng Interceptor

Khi sá»­ dá»¥ng Interceptor, báº¡n cÃ³ thá»ƒ táº¡o má»™t Interceptor Ä‘á»ƒ thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ nhÆ° ghi log. VÃ­ dá»¥:

```java
import org.springframework.web.servlet.HandlerInterceptor;

public class LoggerInterceptor implements HandlerInterceptor {
    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception {
        System.out.println("Request received: " + request.getRequestURI());
        return true;
    }
}
```

> ğŸ“„ **LÆ°u Ã½**: Interceptors giÃºp báº¡n thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ trÆ°á»›c khi yÃªu cáº§u Ä‘áº¿n controller, cháº³ng háº¡n nhÆ° kiá»ƒm tra xÃ¡c thá»±c, ghi log, hoáº·c theo dÃµi thá»i gian pháº£n há»“i.

### VÃ­ dá»¥ sá»­ dá»¥ng Argument Resolver

Argument Resolver cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c tham sá»‘ tÃ¹y chá»‰nh trong phÆ°Æ¡ng thá»©c controller, vÃ­ dá»¥:

```java
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class MyController {

    @GetMapping("/api/v1/test")
    public String testEndpoint(@RequestParam String accessToken) {
        // PhÆ°Æ¡ng thá»©c nÃ y sáº½ sá»­ dá»¥ng AccessTokenDetailsArgumentResolver Ä‘á»ƒ giáº£i quyáº¿t accessToken
        return "Access token: " + accessToken;
    }
}
```

---

## Cáº¥u hÃ¬nh báº£o máº­t Web trong Spring Boot

Cáº¥u hÃ¬nh nÃ y giÃºp á»©ng dá»¥ng Spring Boot báº£o vá»‡ cÃ¡c endpoint, Ä‘iá»u khiá»ƒn quyá»n truy cáº­p vÃ  cáº¥u hÃ¬nh báº£o máº­t cho cÃ¡c yÃªu cáº§u HTTP.

### Má»¥c Ä‘Ã­ch

- Táº¯t báº£o vá»‡ CSRF (Cross-Site Request Forgery) cho cÃ¡c yÃªu cáº§u HTTP.
- Cáº¥u hÃ¬nh quyá»n truy cáº­p cho cÃ¡c endpoint khÃ¡c nhau:
  - Cho phÃ©p táº¥t cáº£ cÃ¡c yÃªu cáº§u tá»›i cÃ¡c endpoint báº¯t Ä‘áº§u báº±ng `/api/`.
  - Chá»‰ cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Ã£ xÃ¡c thá»±c truy cáº­p cÃ¡c endpoint báº¯t Ä‘áº§u báº±ng `/private/`.
  - CÃ¡c yÃªu cáº§u khÃ¡c sáº½ Ä‘Æ°á»£c phÃ©p truy cáº­p mÃ  khÃ´ng yÃªu cáº§u xÃ¡c thá»±c.

### MÃ£ nguá»“n

```java title="WebSecurityConfig.java"
@Configuration
@EnableWebSecurity
public class WebSecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {

        return http
                .csrf(csrf -> csrf.disable())  // Táº¯t báº£o vá»‡ CSRF
                .authorizeHttpRequests((requests) -> requests
                        .requestMatchers("/api/.*").permitAll()  // Cho phÃ©p táº¥t cáº£ yÃªu cáº§u tá»›i cÃ¡c endpoint /api/
                        .requestMatchers("/private/.*").authenticated()  // Chá»‰ cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Ã£ xÃ¡c thá»±c truy cáº­p cÃ¡c endpoint /private/
                        .anyRequest().permitAll()  // Cho phÃ©p táº¥t cáº£ yÃªu cáº§u cÃ²n láº¡i
                ).build();
    }

    // Äoáº¡n mÃ£ dÆ°á»›i Ä‘Ã¢y bá»‹ comment láº¡i vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng náº¿u cáº§n táº¡o ngÆ°á»i dÃ¹ng trong bá»™ nhá»›
//    @Bean
//    public UserDetailsService userDetailsService() {
//        UserDetails user =
//                User.withDefaultPasswordEncoder()
//                        .username("user")
//                        .password("password")
//                        .roles("USER")
//                        .build();
//
//        return new InMemoryUserDetailsManager(user);
//    }
}
```

### Nhá»¯ng cáº¥u hÃ¬nh cáº§n chÃº Ã½

| Cáº¥u hÃ¬nh                                         | Ã nghÄ©a                                                                                                                         |
| ------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------- |
| `@EnableWebSecurity`                             | Báº­t tÃ­nh nÄƒng báº£o máº­t web trong á»©ng dá»¥ng Spring Boot.                                                                           |
| `csrf().disable()`                               | Táº¯t báº£o vá»‡ CSRF cho cÃ¡c yÃªu cáº§u HTTP. Äiá»u nÃ y há»¯u Ã­ch cho cÃ¡c API mÃ  khÃ´ng yÃªu cáº§u báº£o vá»‡ CSRF (vÃ­ dá»¥: API RESTful).           |
| `requestMatchers("/api/.*").permitAll()`         | Cho phÃ©p táº¥t cáº£ cÃ¡c yÃªu cáº§u HTTP Ä‘áº¿n cÃ¡c endpoint báº¯t Ä‘áº§u vá»›i `/api/`. ÄÃ¢y lÃ  nhá»¯ng endpoint cÃ´ng khai, khÃ´ng yÃªu cáº§u xÃ¡c thá»±c. |
| `requestMatchers("/private/.*").authenticated()` | Chá»‰ cho phÃ©p ngÆ°á»i dÃ¹ng Ä‘Ã£ xÃ¡c thá»±c truy cáº­p cÃ¡c endpoint báº¯t Ä‘áº§u vá»›i `/private/`. Nhá»¯ng endpoint nÃ y yÃªu cáº§u xÃ¡c thá»±c.         |
| `anyRequest().permitAll()`                       | Cho phÃ©p táº¥t cáº£ cÃ¡c yÃªu cáº§u cÃ²n láº¡i (khÃ´ng Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh rÃµ trong cÃ¡c `requestMatchers`) mÃ  khÃ´ng yÃªu cáº§u xÃ¡c thá»±c.             |

### Cáº¥u hÃ¬nh trong `application.properties`

```properties
# CÃ¡c cáº¥u hÃ¬nh báº£o máº­t cÃ³ thá»ƒ Ä‘Æ°á»£c thÃªm vÃ o file application.properties, vÃ­ dá»¥:
# Táº¯t báº£o vá»‡ CSRF cho API
security.csrf.enabled=false
```

### Táº¡o ngÆ°á»i dÃ¹ng trong bá»™ nhá»› (optional)

Äoáº¡n mÃ£ dÆ°á»›i Ä‘Ã¢y Ä‘Ã£ bá»‹ comment láº¡i, nhÆ°ng báº¡n cÃ³ thá»ƒ kÃ­ch hoáº¡t Ä‘á»ƒ táº¡o ngÆ°á»i dÃ¹ng trong bá»™ nhá»› cho má»¥c Ä‘Ã­ch thá»­ nghiá»‡m:

```java
@Bean
public UserDetailsService userDetailsService() {
    UserDetails user =
            User.withDefaultPasswordEncoder()
                    .username("user")
                    .password("password")
                    .roles("USER")
                    .build();

    return new InMemoryUserDetailsManager(user);
}
```

Äoáº¡n mÃ£ nÃ y táº¡o má»™t ngÆ°á»i dÃ¹ng vá»›i tÃªn `user`, máº­t kháº©u `password`, vÃ  quyá»n `USER`. NgÆ°á»i dÃ¹ng nÃ y sáº½ Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng Ä‘á»ƒ thá»­ nghiá»‡m tÃ­nh nÄƒng xÃ¡c thá»±c.

### VÃ­ dá»¥ sá»­ dá»¥ng xÃ¡c thá»±c cÆ¡ báº£n

Náº¿u báº¡n muá»‘n thÃªm xÃ¡c thá»±c cÆ¡ báº£n (Basic Authentication) cho á»©ng dá»¥ng cá»§a mÃ¬nh, cÃ³ thá»ƒ cáº¥u hÃ¬nh nhÆ° sau:

```java
@Bean
public SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
    return http
            .csrf(csrf -> csrf.disable())  // Táº¯t báº£o vá»‡ CSRF
            .authorizeHttpRequests((requests) -> requests
                    .requestMatchers("/api/.*").permitAll()  // Cho phÃ©p táº¥t cáº£ yÃªu cáº§u tá»›i cÃ¡c endpoint /api/
                    .requestMatchers("/private/.*").authenticated()  // YÃªu cáº§u xÃ¡c thá»±c cho cÃ¡c endpoint /private/
                    .anyRequest().permitAll()
            )
            .httpBasic()  // Báº­t Basic Authentication
            .and()
            .build();
}
```

---
